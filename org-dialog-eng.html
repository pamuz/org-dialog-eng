<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-11-02 Sun 21:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>org-dialog-engineering</title>
<meta name="author" content="Pablo Munoz" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">org-dialog-engineering</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc8b5a1e">1. Introduction</a></li>
<li><a href="#org04a9393">2. Keymap</a></li>
<li><a href="#org1b943e1">3. PROMPT blocks</a></li>
<li><a href="#orgac0fea9">4. Claude CLI reference</a></li>
<li><a href="#orgc5b1414">5. ASSISTANT blocks</a>
<ul>
<li><a href="#orgc53bd48">5.1. Features</a></li>
</ul>
</li>
<li><a href="#orgc51543d">6. Execution of PROMPT blocks to get ASSISTANT responses</a>
<ul>
<li><a href="#org7ede5a7">6.1. Including previous content as context</a></li>
<li><a href="#orgddb2cd9">6.2. Making the PROMPT blocks executable</a></li>
<li><a href="#orgc1bde22">6.3. Summary of Assistant Responses</a></li>
<li><a href="#orge3ac328">6.4. Binding PROMPT block execution to keys</a></li>
</ul>
</li>
<li><a href="#org00c67a7">7. Making the PROMPT and ASSISTANT blocks look distinc from other org blocks</a></li>
<li><a href="#org5cd9e95">8. Package Header</a></li>
<li><a href="#orgbd9ac36">9. Dependencies</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgc8b5a1e" class="outline-2">
<h2 id="orgc8b5a1e"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a literate programming implementation of <code>org-dialog-eng-mode</code>, an Emacs minor mode that integrates Claude AI into Org mode documents.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; org-dialog-eng-mode-v2.el --- Claude integration for Org mode -*- lexical-binding: t; -*-
(require 'org)
(require 'org-element)

(defface org-dialog-eng-prompt-block
  '((t (:background "#2d3a55" :extend t)))
  "Face for PROMPT block content."
  :group 'org-dialog-eng)

(defface org-dialog-eng-assistant-block
  '((t (:background "#3d2f5b" :extend t)))
  "Face for ASSISTANT block content."
  :group 'org-dialog-eng)

(defun org-dialog-eng--element-is-prompt-block-p (element)
  "Return non-nil if ELEMENT is a PROMPT block."
  (and (eq (org-element-type element) 'special-block)
       (string-equal (upcase (org-element-property :type element)) "PROMPT")))

(defun org-dialog-eng--extract-block-content (element)
  "Extract the content from a special block ELEMENT."
  (let* ((begin (org-element-property :contents-begin element))
         (end (org-element-property :contents-end element)))
    (when (and begin end)
      (string-trim (buffer-substring-no-properties begin end)))))

(defun org-dialog-eng--element-is-response-block-p (element)
  "Return non-nil if ELEMENT is an ASSISTANT block."
  (and (eq (org-element-type element) 'special-block)
       (string-equal (upcase (org-element-property :type element)) "ASSISTANT")))

(defun org-dialog-eng--get-preceding-context ()
  "Extract all buffer content before the current PROMPT block."
  (let* ((element (org-element-at-point))
         (block (org-element-lineage element '(special-block) t))
         (prompt-begin (org-element-property :begin block)))
    (when prompt-begin
      (string-trim
       (buffer-substring-no-properties (point-min) prompt-begin)))))

(defun org-dialog-eng--execute-prompt-block ()
  "Execute the PROMPT block at point by spawning Claude subprocess and inserting response."
  (interactive)
  (let* ((element (org-element-at-point))
         (prompt-content (org-dialog-eng--extract-block-content element))
         (preceding-context (org-dialog-eng--get-preceding-context))
         (prompt (format "
&lt;instructions&gt;
You are a helpful assitant that is helping me write an org document in
Emacs that may contain code (literate programming style). I will provide
you with a prompt and you should respond to it in a very concise
manner. In case the prompt involves a request for code you shall not
edit any files but instead provide the code as output, if the request
involves modification of code you should provide just the changes
necessary (think of a git diff). I will also provide you with some
context (the content of the org file we have written so far) for you to
be better informed.

Whenever you see a #+begin_prompt ... #+end_prompt delimiters the
content inside is a prompt I have given you in the past.

Whenever you see a #+begin_assistant ... #+end_assistant delimiters, the
content inside is a response you have given me, to the preceding prompt,
in the past.

CRITICAL: Since we are editing an org file together, any structure
necessary for your response should be done in org syntax, NOT
markdown. Never respond with markdown UNLESS expclitly asked to in the
prompt.
&lt;/instructions&gt;

&lt;prompt&gt;
%s
&lt;/prompt&gt;

&lt;context&gt;
%s
&lt;/context&gt;
" prompt-content preceding-context)))
    (unless prompt-content
      (error "No prompt content found"))

    ;; Get the end position of the current prompt block
    (let* ((block-end (org-element-property :end element))
           (output-buffer (generate-new-buffer " *claude-output*"))
           (source-buffer (current-buffer)))

      ;; Start the async process
      (message "Sending prompt to Claude...")

      (save-excursion
        (goto-char block-end)
        (forward-line)
        (insert "\n#+begin_assistant\nClaude is working...\n#+end_assistant\n"))

      (make-process
       :name "claude-prompt"
       :buffer output-buffer
       :command (list "claude" "-p" prompt)
       :sentinel
       (lambda (process event)
         (when (string-match-p "finished" event)
           (when (buffer-live-p source-buffer)
             (with-current-buffer source-buffer
               (save-excursion
                 ;; Move to the end of the prompt block
                 (goto-char block-end)
                 (forward-line)
                 ;; Get the response from the output buffer
                 (let ((response (with-current-buffer output-buffer
                                   (buffer-substring-no-properties (point-min) (point-max)))))

                   ;; Check if there's already an ASSISTANT block right after
                   ;; If so, we should replace it; otherwise insert new one
                   (let ((next-element (org-element-at-point)))
                     (when (org-dialog-eng--element-is-response-block-p next-element)
                       ;; Delete the existing ASSISTANT block
                       (delete-region (org-element-property :begin next-element)
                                      (org-element-property :end next-element))))

                   ;; Insert the new ASSISTANT block
                   (insert "\n#+begin_assistant\n")
                   (insert (string-trim response))
                   (insert "\n#+end_assistant\n")))))

           ;; Clean up
           (kill-buffer output-buffer)
           (message "Claude response inserted")))

       :stderr (get-buffer-create "*claude-errors*")))))
(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng--execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")

(define-minor-mode org-dialog-eng-mode
  "Minor mode for Claude integration in Org documents."
  :lighter " OrgDialogEng"
  :keymap org-dialog-eng-mode-map)

(provide 'org-dialog-eng-mode-v2)

(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng--execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")

(provide 'org-dialog-eng)
  (define-minor-mode org-dialog-eng-mode
    "Minor mode for Claude integration in Org mode.

      This mode adds support for PROMPT blocks that send questions to Claude.

      Key bindings:
        \\[org-ctrl-c-ctrl-c] - Execute prompt block at point (sends to Claude)

      Usage:
        1. Create a #+BEGIN_PROMPT block with your question
        2. Position cursor inside the block
        3. Press C-c C-c
        4. Wait for Claude to respond
        5. Claude's response appears in a #+begin_assistant block below"
    :lighter " AI"
    :group 'org-dialog-eng
    (if org-dialog-eng-mode
        (org-dialog-eng--setup)
      (org-dialog-eng--teardown)))

  (defun org-dialog-eng--setup ()
    "Set up org-dialog-eng-mode in the current buffer."
    ;; Add our ctrl-c-ctrl-c hook
    (add-hook 'org-ctrl-c-ctrl-c-hook #'org-dialog-eng--execute-block nil t)

    ;; Add font-lock for block highlighting
    (font-lock-add-keywords nil
                          '(("^\\([ \t]*#\\+begin_prompt\n\\(?:.*\n\\)*?[ \t]*#\\+end_prompt.*$\\)"
                             (1 'org-dialog-eng-prompt-block t))
                            ("^\\([ \t]*#\\+begin_assistant\n\\(?:.*\n\\)*?[ \t]*#\\+end_assistant\\)"
                             (1 'org-dialog-eng-assistant-block t)))
                          t))


  (defun org-dialog-eng--teardown ()
    "Clean up org-dialog-eng-mode in the current buffer."
    ;; Remove our ctrl-c-ctrl-c hook
    (remove-hook 'org-ctrl-c-ctrl-c-hook #'org-dialog-eng--execute-block t)
    (font-lock-remove-keywords nil
                             '(("^\\([ \t]*#\\+begin_prompt\n\\(?:.*\n\\)*?[ \t]*#\\+end_prompt.*$\\)"
                                (1 'org-dialog-eng-prompt-block t))
                               ("^\\([ \t]*#\\+begin_assistant\n\\(?:.*\n\\)*?[ \t]*#\\+end_assistant\\)"
                                (1 'org-dialog-eng-assistant-block t)))))

  (provide 'org-dialog-eng)

        ;;; org-dialog-eng.el ends here

</pre>
</div>
</div>
</div>
<div id="outline-container-org04a9393" class="outline-2">
<h2 id="org04a9393"><span class="section-number-2">2.</span> Keymap</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng--execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")

(provide 'org-dialog-eng)
  (define-minor-mode org-dialog-eng-mode
    "Minor mode for Claude integration in Org mode.

      This mode adds support for PROMPT blocks that send questions to Claude.

      Key bindings:
        \\[org-ctrl-c-ctrl-c] - Execute prompt block at point (sends to Claude)

      Usage:
        1. Create a #+BEGIN_PROMPT block with your question
        2. Position cursor inside the block
        3. Press C-c C-c
        4. Wait for Claude to respond
        5. Claude's response appears in a #+begin_assistant block below"
    :lighter " AI"
    :group 'org-dialog-eng
    (if org-dialog-eng-mode
        (org-dialog-eng--setup)
      (org-dialog-eng--teardown)))

  (defun org-dialog-eng--setup ()
    "Set up org-dialog-eng-mode in the current buffer."
    ;; Add our ctrl-c-ctrl-c hook
    (add-hook 'org-ctrl-c-ctrl-c-hook #'org-dialog-eng--execute-block nil t)

    ;; Add font-lock for block highlighting
    (font-lock-add-keywords nil
                          '(("^\\([ \t]*#\\+begin_prompt\n\\(?:.*\n\\)*?[ \t]*#\\+end_prompt.*$\\)"
                             (1 'org-dialog-eng-prompt-block t))
                            ("^\\([ \t]*#\\+begin_assistant\n\\(?:.*\n\\)*?[ \t]*#\\+end_assistant\\)"
                             (1 'org-dialog-eng-assistant-block t)))
                          t))


  (defun org-dialog-eng--teardown ()
    "Clean up org-dialog-eng-mode in the current buffer."
    ;; Remove our ctrl-c-ctrl-c hook
    (remove-hook 'org-ctrl-c-ctrl-c-hook #'org-dialog-eng--execute-block t)
    (font-lock-remove-keywords nil
                             '(("^\\([ \t]*#\\+begin_prompt\n\\(?:.*\n\\)*?[ \t]*#\\+end_prompt.*$\\)"
                                (1 'org-dialog-eng-prompt-block t))
                               ("^\\([ \t]*#\\+begin_assistant\n\\(?:.*\n\\)*?[ \t]*#\\+end_assistant\\)"
                                (1 'org-dialog-eng-assistant-block t)))))

  (provide 'org-dialog-eng)

        ;;; org-dialog-eng.el ends here

</pre>
</div>
</div>
</div>
<div id="outline-container-org1b943e1" class="outline-2">
<h2 id="org1b943e1"><span class="section-number-2">3.</span> PROMPT blocks</h2>
<div class="outline-text-2" id="text-3">
<p>
This mode defines a new prompt block that can be executed (sent to an
LLM to produce a response block out of). The syntax is
</p>

<pre class="example" id="org33b1149">
#+begin_prompt
Write the shortest implementation of a hello world in python
#+end_prompt
</pre>

<p>
Emacs' org-mode considers anything with the syntax
`#+begin<sub>XXX\n&#x2026;\n</sub>#+end<sub>XXX</sub>` a <b>special block</b> (in contrast to
built-in blocks like `SRC` and `EXAMPLE`). We will take advantage of
this to introduce the concept of PROMPT blocks.
</p>

<p>
In this mode code we will want to know if the pointer is at a prompt
block. Here's a function for that:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun org-dialog-eng--element-is-prompt-block-p (element)
  "Return non-nil if ELEMENT is a PROMPT block."
  (and (eq (org-element-type element) 'special-block)
       (string-equal (upcase (org-element-property :type element)) "PROMPT")))

</pre>
</div>

<p>
For sending the prompt to an LLM we want to get the contents of the
prompt block. Here's a function to get the contents of block as a
string (sans the begin and end markers)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun org-dialog-eng--extract-block-content (element)
  "Extract the content from a special block ELEMENT."
  (let* ((begin (org-element-property :contents-begin element))
         (end (org-element-property :contents-end element)))
    (when (and begin end)
      (string-trim (buffer-substring-no-properties begin end)))))

</pre>
</div>
</div>
</div>
<div id="outline-container-orgac0fea9" class="outline-2">
<h2 id="orgac0fea9"><span class="section-number-2">4.</span> Claude CLI reference</h2>
<div class="outline-text-2" id="text-4">
<p>
&gt; Complete reference for Claude Code command-line interface, including commands and flags.
</p>

<p>
## CLI commands
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Command</td>
<td class="org-left">Description</td>
<td class="org-left">Example</td>
</tr>

<tr>
<td class="org-left">:---------------------------------</td>
<td class="org-left">:---------------------------------------------</td>
<td class="org-left">:-----------------------------------------------------------------</td>
</tr>

<tr>
<td class="org-left">`claude`</td>
<td class="org-left">Start interactive REPL</td>
<td class="org-left">`claude`</td>
</tr>

<tr>
<td class="org-left">`claude "query"`</td>
<td class="org-left">Start REPL with initial prompt</td>
<td class="org-left">`claude "explain this project"`</td>
</tr>

<tr>
<td class="org-left">`claude -p "query"`</td>
<td class="org-left">Query via SDK, then exit</td>
<td class="org-left">`claude -p "explain this function"`</td>
</tr>

<tr>
<td class="org-left">`cat file \</td>
<td class="org-left">claude -p "query"`</td>
<td class="org-left">Process piped content</td>
<td class="org-left">`cat logs.txt \</td>
<td class="org-left">claude -p "explain"`</td>
</tr>

<tr>
<td class="org-left">`claude -c`</td>
<td class="org-left">Continue most recent conversation</td>
<td class="org-left">`claude -c`</td>
</tr>

<tr>
<td class="org-left">`claude -c -p "query"`</td>
<td class="org-left">Continue via SDK</td>
<td class="org-left">`claude -c -p "Check for type errors"`</td>
</tr>

<tr>
<td class="org-left">`claude -r "&lt;session-id&gt;" "query"`</td>
<td class="org-left">Resume session by ID</td>
<td class="org-left">`claude -r "abc123" "Finish this PR"`</td>
</tr>

<tr>
<td class="org-left">`claude update`</td>
<td class="org-left">Update to latest version</td>
<td class="org-left">`claude update`</td>
</tr>

<tr>
<td class="org-left">`claude mcp`</td>
<td class="org-left">Configure Model Context Protocol (MCP) servers</td>
<td class="org-left">See the [Claude Code MCP documentation](/en/docs/claude-code/mcp).</td>
</tr>
</tbody>
</table>

<p>
## CLI flags
</p>

<p>
Customize Claude Code's behavior with these command-line flags:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Flag</td>
<td class="org-left">Description</td>
<td class="org-left">Example</td>
</tr>

<tr>
<td class="org-left">:-------------------------------</td>
<td class="org-left">:-------------------------------------------------------------------------------------------------------------------------------------------------------</td>
<td class="org-left">:-------------------------------------------------------------------------------------------------</td>
</tr>

<tr>
<td class="org-left">`&#x2013;add-dir`</td>
<td class="org-left">Add additional working directories for Claude to access (validates each path exists as a directory)</td>
<td class="org-left">`claude &#x2013;add-dir ../apps ../lib`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;agents`</td>
<td class="org-left">Define custom [subagents](/en/docs/claude-code/sub-agents) dynamically via JSON (see below for format)</td>
<td class="org-left">`claude &#x2013;agents '{"reviewer":{"description":"Reviews code","prompt":"You are a code reviewer"}}'`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;allowedTools`</td>
<td class="org-left">A list of tools that should be allowed without prompting the user for permission, in addition to [settings.json files](/en/docs/claude-code/settings)</td>
<td class="org-left">`"Bash(git log:*)" "Bash(git diff:*)" "Read"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;disallowedTools`</td>
<td class="org-left">A list of tools that should be disallowed without prompting the user for permission, in addition to [settings.json files](/en/docs/claude-code/settings)</td>
<td class="org-left">`"Bash(git log:*)" "Bash(git diff:*)" "Edit"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;print`, `-p`</td>
<td class="org-left">Print response without interactive mode (see [SDK documentation](/en/docs/claude-code/sdk) for programmatic usage details)</td>
<td class="org-left">`claude -p "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;system-prompt`</td>
<td class="org-left">Replace the entire system prompt with custom text (works in both interactive and print modes; added in v2.0.14)</td>
<td class="org-left">`claude &#x2013;system-prompt "You are a Python expert"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;system-prompt-file`</td>
<td class="org-left">Load system prompt from a file, replacing the default prompt (print mode only; added in v1.0.54)</td>
<td class="org-left">`claude -p &#x2013;system-prompt-file ./custom-prompt.txt "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;append-system-prompt`</td>
<td class="org-left">Append custom text to the end of the default system prompt (works in both interactive and print modes; added in v1.0.55)</td>
<td class="org-left">`claude &#x2013;append-system-prompt "Always use TypeScript"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;output-format`</td>
<td class="org-left">Specify output format for print mode (options: `text`, `json`, `stream-json`)</td>
<td class="org-left">`claude -p "query" &#x2013;output-format json`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;input-format`</td>
<td class="org-left">Specify input format for print mode (options: `text`, `stream-json`)</td>
<td class="org-left">`claude -p &#x2013;output-format json &#x2013;input-format stream-json`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;include-partial-messages`</td>
<td class="org-left">Include partial streaming events in output (requires `&#x2013;print` and `&#x2013;output-format=stream-json`)</td>
<td class="org-left">`claude -p &#x2013;output-format stream-json &#x2013;include-partial-messages "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;verbose`</td>
<td class="org-left">Enable verbose logging, shows full turn-by-turn output (helpful for debugging in both print and interactive modes)</td>
<td class="org-left">`claude &#x2013;verbose`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;max-turns`</td>
<td class="org-left">Limit the number of agentic turns in non-interactive mode</td>
<td class="org-left">`claude -p &#x2013;max-turns 3 "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;model`</td>
<td class="org-left">Sets the model for the current session with an alias for the latest model (`sonnet` or `opus`) or a model's full name</td>
<td class="org-left">`claude &#x2013;model claude-sonnet-4-5-20250929`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;permission-mode`</td>
<td class="org-left">Begin in a specified [permission mode](iam#permission-modes)</td>
<td class="org-left">`claude &#x2013;permission-mode plan`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;permission-prompt-tool`</td>
<td class="org-left">Specify an MCP tool to handle permission prompts in non-interactive mode</td>
<td class="org-left">`claude -p &#x2013;permission-prompt-tool mcp<sub>auth</sub><sub>tool</sub> "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;resume`</td>
<td class="org-left">Resume a specific session by ID, or by choosing in interactive mode</td>
<td class="org-left">`claude &#x2013;resume abc123 "query"`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;continue`</td>
<td class="org-left">Load the most recent conversation in the current directory</td>
<td class="org-left">`claude &#x2013;continue`</td>
</tr>

<tr>
<td class="org-left">`&#x2013;dangerously-skip-permissions`</td>
<td class="org-left">Skip permission prompts (use with caution)</td>
<td class="org-left">`claude &#x2013;dangerously-skip-permissions`</td>
</tr>
</tbody>
</table>

<p>
&lt;Tip&gt;
  The `&#x2013;output-format json` flag is particularly useful for scripting and
  automation, allowing you to parse Claude's responses programmatically.
&lt;/Tip&gt;
</p>

<p>
### Agents flag format
</p>

<p>
The `&#x2013;agents` flag accepts a JSON object that defines one or more custom subagents. Each subagent requires a unique name (as the key) and a definition object with the following fields:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Field</td>
<td class="org-left">Required</td>
<td class="org-left">Description</td>
</tr>

<tr>
<td class="org-left">:------------</td>
<td class="org-left">:-------</td>
<td class="org-left">:--------------------------------------------------------------------------------------------------------------</td>
</tr>

<tr>
<td class="org-left">`description`</td>
<td class="org-left">Yes</td>
<td class="org-left">Natural language description of when the subagent should be invoked</td>
</tr>

<tr>
<td class="org-left">`prompt`</td>
<td class="org-left">Yes</td>
<td class="org-left">The system prompt that guides the subagent's behavior</td>
</tr>

<tr>
<td class="org-left">`tools`</td>
<td class="org-left">No</td>
<td class="org-left">Array of specific tools the subagent can use (e.g., `["Read", "Edit", "Bash"]`). If omitted, inherits all tools</td>
</tr>

<tr>
<td class="org-left">`model`</td>
<td class="org-left">No</td>
<td class="org-left">Model alias to use: `sonnet`, `opus`, or `haiku`. If omitted, uses the default subagent model</td>
</tr>
</tbody>
</table>

<p>
Example:
</p>

<p>
```bash  theme={null}
claude &#x2013;agents '{
  "code-reviewer": {
    "description": "Expert code reviewer. Use proactively after code changes.",
    "prompt": "You are a senior code reviewer. Focus on code quality, security, and best practices.",
    "tools": ["Read", "Grep", "Glob", "Bash"],
    "model": "sonnet"
  },
  "debugger": {
    "description": "Debugging specialist for errors and test failures.",
    "prompt": "You are an expert debugger. Analyze errors, identify root causes, and provide fixes."
  }
}'
```
</p>

<p>
For more details on creating and using subagents, see the [subagents documentation](/en/docs/claude-code/sub-agents).
</p>

<p>
### System prompt flags
</p>

<p>
Claude Code provides three flags for customizing the system prompt, each serving a different purpose:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Flag</td>
<td class="org-left">Behavior</td>
<td class="org-left">Modes</td>
<td class="org-left">Use Case</td>
</tr>

<tr>
<td class="org-left">:-----------------------</td>
<td class="org-left">:---------------------------------</td>
<td class="org-left">:------------------</td>
<td class="org-left">:-------------------------------------------------------------------</td>
</tr>

<tr>
<td class="org-left">`&#x2013;system-prompt`</td>
<td class="org-left"><b><b>Replaces</b></b> entire default prompt</td>
<td class="org-left">Interactive + Print</td>
<td class="org-left">Complete control over Claude's behavior and instructions</td>
</tr>

<tr>
<td class="org-left">`&#x2013;system-prompt-file`</td>
<td class="org-left"><b><b>Replaces</b></b> with file contents</td>
<td class="org-left">Print only</td>
<td class="org-left">Load prompts from files for reproducibility and version control</td>
</tr>

<tr>
<td class="org-left">`&#x2013;append-system-prompt`</td>
<td class="org-left"><b><b>Appends</b></b> to default prompt</td>
<td class="org-left">Interactive + Print</td>
<td class="org-left">Add specific instructions while keeping default Claude Code behavior</td>
</tr>
</tbody>
</table>

<p>
<b><b>When to use each:</b></b>
</p>

<p>
<b><b>`&#x2013;system-prompt`</b></b>: Use when you need complete control over Claude's system prompt. This removes all default Claude Code instructions, giving you a blank slate.
 ```bash  theme={null}
 claude &#x2013;system-prompt "You are a Python expert who only writes type-annotated code"
 ```
</p>

<p>
<b><b>`&#x2013;system-prompt-file`</b></b>: Use when you want to load a custom prompt from a file, useful for team consistency or version-controlled prompt templates.
 ```bash  theme={null}
 claude -p &#x2013;system-prompt-file ./prompts/code-review.txt "Review this PR"
 ```
</p>

<p>
<b><b>`&#x2013;append-system-prompt`</b></b>: Use when you want to add specific instructions while keeping Claude Code's default capabilities intact. This is the safest option for most use cases.
 ```bash  theme={null}
 claude &#x2013;append-system-prompt "Always use TypeScript and include JSDoc comments"
 ```
</p>

<p>
&lt;Note&gt;
  `&#x2013;system-prompt` and `&#x2013;system-prompt-file` are mutually exclusive. You cannot use both flags simultaneously.
&lt;/Note&gt;
</p>

<p>
&lt;Tip&gt;
  For most use cases, `&#x2013;append-system-prompt` is recommended as it preserves Claude Code's built-in capabilities while adding your custom requirements. Use `&#x2013;system-prompt` or `&#x2013;system-prompt-file` only when you need complete control over the system prompt.
&lt;/Tip&gt;
</p>

<p>
For detailed information about print mode (`-p`) including output formats,
streaming, verbose logging, and programmatic usage, see the
[SDK documentation](/en/docs/claude-code/sdk).
</p>

<p>
## See also
</p>
</div>
</div>
<div id="outline-container-orgc5b1414" class="outline-2">
<h2 id="orgc5b1414"><span class="section-number-2">5.</span> ASSISTANT blocks</h2>
<div class="outline-text-2" id="text-5">
<p>
In org-dialog-eng mode, the response for a prompt coming from the LLM
will be written into the document, as an ASSISTANT block, right below
the PROMPT block that created it.
</p>

<p>
In a similar way to how we define helper functions for the PROMPT
blocks we define equivalents for the ASSITANT blocks.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun org-dialog-eng--element-is-response-block-p (element)
  "Return non-nil if ELEMENT is an ASSISTANT block."
  (and (eq (org-element-type element) 'special-block)
       (string-equal (upcase (org-element-property :type element)) "ASSISTANT")))

</pre>
</div>
</div>
<div id="outline-container-orgc53bd48" class="outline-3">
<h3 id="orgc53bd48"><span class="section-number-3">5.1.</span> Features</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Execute PROMPT blocks with <code>C-c C-c</code> to send questions to Claude</li>
<li>Get responses in assistant blocks automatically</li>
<li>Context-aware: sends all content before the prompt as context</li>
<li>Async execution: Emacs stays responsive while Claude thinks</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc51543d" class="outline-2">
<h2 id="orgc51543d"><span class="section-number-2">6.</span> Execution of PROMPT blocks to get ASSISTANT responses</h2>
<div class="outline-text-2" id="text-6">
<p>
The following takes place when the user executes a PROMPT block from
within an org-mode buffer:
</p>

<ol class="org-ol">
<li>The buffer becomes read only (to prevent the user from writing more
before the prompt is executed and the result inserted).</li>
<li>An ASSISTANT block is inserted immediately after the executed
PROMPT block for immediate feedback. It contains the temporary text
"Claude is working&#x2026;"</li>
<li>A subprocess is spawned with prompt and a prompt formatted with a
general instruction, the content from the PROMPT block being
executed, and an additional context (the content of the file up to
the PROMPT block being executed).</li>
<li>Once the subprocess finishes and Claude has responded, the response
is inserted in the ASSISTANT block, replacing the "Claude is
working&#x2026;" placeholder.</li>
<li>The buffer becomes writeable to the user again.</li>
</ol>

<p>
Notes:
</p>
<ul class="org-ul">
<li>Claude will be executed with `&#x2013;print` flag to not start an
interactive session.</li>
</ul>
</div>
<div id="outline-container-org7ede5a7" class="outline-3">
<h3 id="org7ede5a7"><span class="section-number-3">6.1.</span> Including previous content as context</h3>
<div class="outline-text-3" id="text-6-1">
<p>
In literate programming, the file content up to the current PROMPT
block should be sent as context with each query. We'll implement a
function to extract this preceding content as a string.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun org-dialog-eng--get-preceding-context ()
  "Extract all buffer content before the current PROMPT block."
  (let* ((element (org-element-at-point))
         (block (org-element-lineage element '(special-block) t))
         (prompt-begin (org-element-property :begin block)))
    (when prompt-begin
      (string-trim
       (buffer-substring-no-properties (point-min) prompt-begin)))))

</pre>
</div>
</div>
</div>
<div id="outline-container-orgddb2cd9" class="outline-3">
<h3 id="orgddb2cd9"><span class="section-number-3">6.2.</span> Making the PROMPT blocks executable</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun org-dialog-eng--execute-prompt-block ()
  "Execute the PROMPT block at point by spawning Claude subprocess and inserting response."
  (interactive)
  (let* ((element (org-element-at-point))
         (prompt-content (org-dialog-eng--extract-block-content element))
         (preceding-context (org-dialog-eng--get-preceding-context))
         (prompt (format "
&lt;instructions&gt;
You are a helpful assitant that is helping me write an org document in
Emacs that may contain code (literate programming style). I will provide
you with a prompt and you should respond to it in a very concise
manner. In case the prompt involves a request for code you shall not
edit any files but instead provide the code as output, if the request
involves modification of code you should provide just the changes
necessary (think of a git diff). I will also provide you with some
context (the content of the org file we have written so far) for you to
be better informed.

Whenever you see a #+begin_prompt ... #+end_prompt delimiters the
content inside is a prompt I have given you in the past.

Whenever you see a #+begin_assistant ... #+end_assistant delimiters, the
content inside is a response you have given me, to the preceding prompt,
in the past.

CRITICAL: Since we are editing an org file together, any structure
necessary for your response should be done in org syntax, NOT
markdown. Never respond with markdown UNLESS expclitly asked to in the
prompt.
&lt;/instructions&gt;

&lt;prompt&gt;
%s
&lt;/prompt&gt;

&lt;context&gt;
%s
&lt;/context&gt;
" prompt-content preceding-context)))
    (unless prompt-content
      (error "No prompt content found"))

    ;; Get the end position of the current prompt block
    (let* ((block-end (org-element-property :end element))
           (output-buffer (generate-new-buffer " *claude-output*"))
           (source-buffer (current-buffer)))

      ;; Start the async process
      (message "Sending prompt to Claude...")

      (save-excursion
        (goto-char block-end)
        (forward-line)
        (insert "\n#+begin_assistant\nClaude is working...\n#+end_assistant\n"))

      (make-process
       :name "claude-prompt"
       :buffer output-buffer
       :command (list "claude" "-p" prompt)
       :sentinel
       (lambda (process event)
         (when (string-match-p "finished" event)
           (when (buffer-live-p source-buffer)
             (with-current-buffer source-buffer
               (save-excursion
                 ;; Move to the end of the prompt block
                 (goto-char block-end)
                 (forward-line)
                 ;; Get the response from the output buffer
                 (let ((response (with-current-buffer output-buffer
                                   (buffer-substring-no-properties (point-min) (point-max)))))

                   ;; Check if there's already an ASSISTANT block right after
                   ;; If so, we should replace it; otherwise insert new one
                   (let ((next-element (org-element-at-point)))
                     (when (org-dialog-eng--element-is-response-block-p next-element)
                       ;; Delete the existing ASSISTANT block
                       (delete-region (org-element-property :begin next-element)
                                      (org-element-property :end next-element))))

                   ;; Insert the new ASSISTANT block
                   (insert "\n#+begin_assistant\n")
                   (insert (string-trim response))
                   (insert "\n#+end_assistant\n")))))

           ;; Clean up
           (kill-buffer output-buffer)
           (message "Claude response inserted")))

       :stderr (get-buffer-create "*claude-errors*")))))
</pre>
</div>

<div class="prompt" id="org1e58fdd">
<p>
going great
</p>

</div>

<div class="assistant" id="org72b7880">
<p>
Thanks! It looks like the implementation is working well. Is there anything specific you'd like me to help with next, or would you like me to review what we've built so far?
[?25h[?25h
</p>

</div>

<div class="assistant" id="org65ebf3e">
<p>
Claude is working&#x2026;
</p>

</div>

<div class="prompt" id="org00c5918">
<p>
can you give me a summary of your responses?
</p>

</div>

<p>
#+begin<sub>assistant</sub>
Based on the context, here's a summary of my previous responses in this org document:
</p>
</div>
</div>
<div id="outline-container-orgc1bde22" class="outline-3">
<h3 id="orgc1bde22"><span class="section-number-3">6.3.</span> Summary of Assistant Responses</h3>
<div class="outline-text-3" id="text-6-3">
<ol class="org-ol">
<li><b>Initial positive feedback</b> - Acknowledged that the implementation was working well and offered to help with next steps or review the code</li>

<li><b>Follow-up offer</b> - Asked if there was anything specific needed or if a review of the current implementation would be helpful</li>
</ol>

<p>
That's all the responses so far - there were just two brief messages confirming progress and offering continued assistance.
[?25h[?25h
#+end<sub>assistant</sub>
</p>

<div class="assistant" id="orga67d569">
<p>
Claude is working&#x2026;
</p>

</div>
</div>
</div>
<div id="outline-container-orge3ac328" class="outline-3">
<h3 id="orge3ac328"><span class="section-number-3">6.4.</span> Binding PROMPT block execution to keys</h3>
<div class="outline-text-3" id="text-6-4">
<div class="prompt" id="org4e40b47">
<p>
How would I bind the execute-prompt-block function to Ctrl-c Ctrl-c
in this mode we are writing?
</p>

</div>

<div class="assistant" id="orgfcd40ab">
<p>
To bind `org-dialog-eng&#x2013;execute-prompt-block` to `C-c C-c` in your mode, you need to:
</p>

<ol class="org-ol">
<li>Create a keymap for the mode</li>
<li>Define the key binding in that keymap</li>
<li>Make the minor mode use that keymap</li>
</ol>

<p>
Here's the code to add:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng--execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")

(define-minor-mode org-dialog-eng-mode
  "Minor mode for Claude integration in Org documents."
  :lighter " OrgDialogEng"
  :keymap org-dialog-eng-mode-map)

(provide 'org-dialog-eng-mode-v2)
</pre>
</div>

<p>
The key parts:
</p>
<ul class="org-ul">
<li>`defvar org-dialog-eng-mode-map` creates the keymap</li>
<li>`define-key` binds `C-c C-c` to your function</li>
<li>`define-minor-mode` creates the mode and associates it with the keymap via `:keymap`</li>
<li>The `:lighter` adds " OrgDialogEng" to the mode line when active</li>
</ul>

<p>
Users would activate it with `M-x org-dialog-eng-mode` in an org buffer.
</p>

<p>
To bind `org-dialog-eng&#x2013;execute-prompt-block` to `C-c C-c` in your mode, you need to:
</p>

<ol class="org-ol">
<li>Create a keymap for the mode</li>
<li>Define the key binding in that keymap</li>
<li>Make the minor mode use that keymap</li>
</ol>

<p>
Here's the code to add:
</p>

<p>
```emacs-lisp
(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng&#x2013;execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")
</p>

<p>
(define-minor-mode org-dialog-eng-mode
  "Minor mode for Claude integration in Org documents."
  :lighter " OrgDialogEng"
  :keymap org-dialog-eng-mode-map)
</p>

<p>
(provide 'org-dialog-eng-mode-v2)
```
</p>

<p>
The key parts:
</p>
<ul class="org-ul">
<li>`defvar org-dialog-eng-mode-map` creates the keymap</li>
<li>`define-key` binds `C-c C-c` to your function</li>
<li>`define-minor-mode` creates the mode and associates it with the keymap via `:keymap`</li>
<li>The `:lighter` adds " OrgDialogEng" to the mode line when active</li>
</ul>

<p>
Users would activate it with `M-x org-dialog-eng-mode` in an org buffer.
</p>

<p>
Create a keymap for the mode
</p>

<p>
Define the key binding in that keymap
</p>

<p>
Make the minor mode use that keymap
</p>

<p>
Here's the code to add:
</p>

<p>
```emacs-lisp
(defvar org-dialog-eng-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map (kbd "C-c C-c") #'org-dialog-eng&#x2013;execute-prompt-block)
    map)
  "Keymap for org-dialog-eng-mode.")
</p>

<p>
(define-minor-mode org-dialog-eng-mode
  "Minor mode for Claude integration in Org documents."
  :lighter " OrgDialogEng"
  :keymap org-dialog-eng-mode-map)
</p>

<p>
(provide 'org-dialog-eng-mode-v2)
```
</p>

<p>
The key parts:
</p>

<ul class="org-ul">
<li>`defvar org-dialog-eng-mode-map` creates the keymap</li>
<li>`define-key` binds `C-c C-c` to your function</li>
<li>`define-minor-mode` creates the mode and associates it with the keymap via `:keymap`</li>
<li>The `:lighter` adds " OrgDialogEng" to the mode line when active</li>
</ul>

<p>
Users would activate it with `M-x org-dialog-eng-mode` in an org buffer.
</p>

<p>
`defvar org-dialog-eng-mode-map` creates the keymap
</p>

<p>
`define-key` binds `C-c C-c` to your function
</p>

<p>
`define-minor-mode` creates the mode and associates it with the keymap via `:keymap`
</p>

<p>
The `:lighter` adds " OrgDialogEng" to the mode line when active
</p>

<p>
Users would activate it with `M-x org-dialog-eng-mode` in an org buffer.
</p>

<p>
Help me understand what this file is and what you'd like me to do with it.
</p>

</div>
</div>
</div>
</div>
<div id="outline-container-org00c67a7" class="outline-2">
<h2 id="org00c67a7"><span class="section-number-2">7.</span> Making the PROMPT and ASSISTANT blocks look distinc from other org blocks</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defface org-dialog-eng-prompt-block
  '((t (:background "#2d3a55" :extend t)))
  "Face for PROMPT block content."
  :group 'org-dialog-eng)

(defface org-dialog-eng-assistant-block
  '((t (:background "#3d2f5b" :extend t)))
  "Face for ASSISTANT block content."
  :group 'org-dialog-eng)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5cd9e95" class="outline-2">
<h2 id="org5cd9e95"><span class="section-number-2">8.</span> Package Header</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; org-dialog-eng.el --- Claude integration for Org mode -*- lexical-binding: t; -*-

;; Copyright (C) 2025

;; Author: Pablo Munoz
;; Version: 0.3.0
;; Package-Requires: ((emacs "27.1") (org "9.0"))
;; Keywords: org, ai, claude, prompts
;; URL: https://github.com/pmunoz/org-dialog-eng

;;; Commentary:

;; This package provides integration between Org mode and Claude AI.
;;
;; Usage:
;; 1. Create a #+BEGIN_PROMPT block with your question
;; 2. Position cursor inside the block
;; 3. Press C-c C-c
;; 4. Wait for Claude to respond
;; 5. Claude's response appears in a #+begin_assistant block below
;;
;; The mode sends all content before the prompt as context, enabling
;; natural conversations that reference your notes and code.
;;
;; Setup:
;;   (require 'org-dialog-eng)
;;   (add-hook 'org-mode-hook #'org-dialog-eng-mode)

;;; Code:
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd9ac36" class="outline-2">
<h2 id="orgbd9ac36"><span class="section-number-2">9.</span> Dependencies</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(require 'org)
(require 'org-element)
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Pablo Munoz</p>
<p class="date">Created: 2025-11-02 Sun 21:13</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
